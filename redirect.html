<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>التحويل الذكي للمنتجات | هدايا الإمارات</title>
  <meta name="robots" content="noindex,follow">
  <link rel="stylesheet" href="style.css">
  <style>
    .center{max-width:800px;margin:120px auto 60px;background:#fff;padding:2rem;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08);text-align:center}
    .alt-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:1.5rem}
    .alt-card{background:#f8f9fa;border-radius:12px;padding:1rem}
    .count{font-size:2rem;color:#667eea;font-weight:800}
  </style>
</head>
<body>
  <section class="center">
    <h1>⏳ جاري توجيهك لمنتج مشابه</h1>
    <p>نحاول إيجاد أفضل بديل للمنتج الذي تبحث عنه. سيتم تحويلك تلقائياً.</p>
    <div>سيتم التحويل خلال <span id="count" class="count">5</span> ثوان</div>
    <div id="alts" class="alt-grid"></div>
    <div style="margin-top:1rem"><a href="/" class="btn btn-outline">الانتقال للرئيسية الآن</a></div>
  </section>

  <script src="products-data.js"></script>
  <script>
    function getTerms(){
      const path = (location.pathname||'').toLowerCase();
      const name = decodeURIComponent(path.split('/').pop().replace('.html',''));
      return name.replace(/[^\u0600-\u06FF\w\s-]/g,'').split(/[-\s_]+/).filter(t=>t.length>1);
    }
    function slug(t){return t.toLowerCase().replace(/[^\u0600-\u06FF\w\s-]/g,'').replace(/[\s_-]+/g,'-').replace(/^-+|-+$/g,'')}

    const all = [...(window.watchesData||[]), ...(window.perfumesData||[])];
    const terms = getTerms();

    function score(p){
      const title = (p.title||'').toLowerCase();
      let s = 0; terms.forEach(t=>{ if(title.includes(t)) s += t.length; });
      if(title.includes('ساعة')) s += 1; if(title.includes('عطر')) s += 1;
      return s;
    }

    const alts = all.map(p=>({p, s:score(p)})).filter(x=>x.s>0).sort((a,b)=>b.s-a.s).slice(0,6).map(x=>x.p);

    const wrap = document.getElementById('alts');
    if(alts.length){
      wrap.innerHTML = alts.map(p=>{
        const s = slug(p.title);
        return `<div class=\"alt-card\">\n          <img src=\"${p.image_link}\" alt=\"${p.title}\" style=\"width:100%;height:140px;object-fit:cover;border-radius:8px;\">\n          <h4 style=\"margin:.5rem 0\">${p.title}</h4>\n          <div style=\"color:#667eea;font-weight:700\">${p.sale_price} درهم</div>\n          <a class=\"btn btn-primary btn-sm\" href=\"/products/${s}.html\">شاهد المنتج</a>\n        </div>`
      }).join('');
    }

    // عد تنازلي 5 ثوان + تحويل تلقائي
    let c = 5; const el = document.getElementById('count');
    const timer = setInterval(()=>{ c--; el.textContent = c; if(c<=0){
      clearInterval(timer);
      if(alts.length){ location.href = `/products/${slug(alts[0].title)}.html`; }
      else { location.href = '/'; }
    }},1000);
  </script>
</body>
</html>
